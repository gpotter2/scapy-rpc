# SPDX-License-Identifier: GPL-2.0-only
# This file is part of Scapy RPC
# See https://scapy.net/ for more information
# Copyright (C) Gabriel Potter

# [ms-mqmr] v18.0 (Tue, 23 Apr 2024)

"""
RPC definitions for the following interfaces:
- qmmgmt (v1.0): 41208ee0-e970-11d1-9b9e-00e02c064c39
This file is auto-generated by midl-to-scapy, do not modify.
"""

from enum import IntEnum
import uuid

from scapy.fields import StrFixedLenField
from scapy.layers.dcerpc import (
    NDRPacket,
    DceRpcOp,
    NDRByteField,
    NDRConfFieldListField,
    NDRConfPacketListField,
    NDRConfStrLenField,
    NDRConfVarStrNullField,
    NDRConfVarStrNullFieldUtf16,
    NDRFullEmbPointerField,
    NDRInt3264EnumField,
    NDRIntField,
    NDRLongField,
    NDRPacketField,
    NDRRecursiveClass,
    NDRShortField,
    NDRSignedByteField,
    NDRSignedIntField,
    NDRSignedLongField,
    NDRSignedShortField,
    NDRUnionField,
    register_dcerpc_interface,
)


class MgmtObjectType(IntEnum):
    MGMT_MACHINE = 1
    MGMT_QUEUE = 2
    MGMT_SESSION = 3


class QUEUE_FORMAT_TYPE(IntEnum):
    QUEUE_FORMAT_TYPE_UNKNOWN = 0
    QUEUE_FORMAT_TYPE_PUBLIC = 1
    QUEUE_FORMAT_TYPE_PRIVATE = 2
    QUEUE_FORMAT_TYPE_DIRECT = 3
    QUEUE_FORMAT_TYPE_MACHINE = 4
    QUEUE_FORMAT_TYPE_CONNECTOR = 5
    QUEUE_FORMAT_TYPE_DL = 6
    QUEUE_FORMAT_TYPE_MULTICAST = 7
    QUEUE_FORMAT_TYPE_SUBQUEUE = 8


class GUID(NDRPacket):
    ALIGNMENT = (4, 4)
    fields_desc = [
        NDRIntField("Data1", 0),
        NDRShortField("Data2", 0),
        NDRShortField("Data3", 0),
        StrFixedLenField("Data4", "", length=8),
    ]


class OBJECTID(NDRPacket):
    ALIGNMENT = (4, 4)
    fields_desc = [
        NDRPacketField("Lineage", GUID(), GUID),
        NDRIntField("Uniquifier", 0),
    ]


class DL_ID(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRPacketField("m_DlGuid", GUID(), GUID),
        NDRFullEmbPointerField(NDRConfVarStrNullFieldUtf16("m_pwzDomain", "")),
    ]


class MULTICAST_ID(NDRPacket):
    ALIGNMENT = (4, 4)
    fields_desc = [NDRIntField("m_address", 0), NDRIntField("m_port", 0)]


class QUEUE_FORMAT(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRByteField("m_qft", 0),
        NDRByteField("m_SuffixAndFlags", 0),
        NDRShortField("m_reserved", 0),
        NDRUnionField(
            [
                (
                    StrFixedLenField("value", "", length=0),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_UNKNOWN
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_UNKNOWN
                        ),
                    ),
                ),
                (
                    NDRPacketField("value", GUID(), GUID),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_PUBLIC
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_PUBLIC
                        ),
                    ),
                ),
                (
                    NDRPacketField("value", OBJECTID(), OBJECTID),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_PRIVATE
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_PRIVATE
                        ),
                    ),
                ),
                (
                    NDRFullEmbPointerField(NDRConfVarStrNullFieldUtf16("value", "")),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_DIRECT
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_DIRECT
                        ),
                    ),
                ),
                (
                    NDRPacketField("value", GUID(), GUID),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_MACHINE
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_MACHINE
                        ),
                    ),
                ),
                (
                    NDRPacketField("value", GUID(), GUID),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_CONNECTOR
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_CONNECTOR
                        ),
                    ),
                ),
                (
                    NDRPacketField("value", DL_ID(), DL_ID),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_DL
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_DL
                        ),
                    ),
                ),
                (
                    NDRPacketField("value", MULTICAST_ID(), MULTICAST_ID),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_MULTICAST
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_MULTICAST
                        ),
                    ),
                ),
                (
                    NDRFullEmbPointerField(NDRConfVarStrNullFieldUtf16("value", "")),
                    (
                        (
                            lambda pkt: getattr(pkt, "m_qft", None)
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_SUBQUEUE
                        ),
                        (
                            lambda _, val: val.tag
                            == QUEUE_FORMAT_TYPE.QUEUE_FORMAT_TYPE_SUBQUEUE
                        ),
                    ),
                ),
            ],
            StrFixedLenField("value", "", length=0),
            align=(1, 8),
            switch_fmt=("B", "B"),
        ),
    ]


class MGMT_OBJECT(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRInt3264EnumField("type", 0, MgmtObjectType),
        NDRUnionField(
            [
                (
                    NDRFullEmbPointerField(
                        NDRPacketField("value", QUEUE_FORMAT(), QUEUE_FORMAT)
                    ),
                    (
                        (
                            lambda pkt: getattr(pkt, "type", None)
                            == MgmtObjectType.MGMT_QUEUE
                        ),
                        (lambda _, val: val.tag == MgmtObjectType.MGMT_QUEUE),
                    ),
                ),
                (
                    NDRIntField("value", 0),
                    (
                        (
                            lambda pkt: getattr(pkt, "type", None)
                            == MgmtObjectType.MGMT_MACHINE
                        ),
                        (lambda _, val: val.tag == MgmtObjectType.MGMT_MACHINE),
                    ),
                ),
                (
                    NDRIntField("value", 0),
                    (
                        (
                            lambda pkt: getattr(pkt, "type", None)
                            == MgmtObjectType.MGMT_SESSION
                        ),
                        (lambda _, val: val.tag == MgmtObjectType.MGMT_SESSION),
                    ),
                ),
            ],
            StrFixedLenField("value", "", length=0),
            align=(2, 8),
            switch_fmt=("H", "I"),
        ),
    ]


class VARENUM(IntEnum):
    VT_EMPTY = 0
    VT_NULL = 1
    VT_I2 = 2
    VT_I4 = 3
    VT_BOOL = 11
    VT_VARIANT = 12
    VT_I1 = 16
    VT_UI1 = 17
    VT_UI2 = 18
    VT_UI4 = 19
    VT_I8 = 20
    VT_UI8 = 21
    VT_LPWSTR = 31
    VT_BLOB = 65
    VT_CLSID = 72
    VT_VECTOR = 4096


class LARGE_INTEGER(NDRPacket):
    ALIGNMENT = (8, 8)
    fields_desc = [NDRSignedLongField("QuadPart", 0)]


class ULARGE_INTEGER(NDRPacket):
    ALIGNMENT = (8, 8)
    fields_desc = [NDRLongField("QuadPart", 0)]


class BLOB(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cbSize", None, size_of="pBlobData"),
        NDRFullEmbPointerField(
            NDRConfStrLenField("pBlobData", "", size_is=lambda pkt: pkt.cbSize)
        ),
    ]


class CAUB(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfStrLenField("pElems", "", size_is=lambda pkt: pkt.cElems)
        ),
    ]


class CAUI(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfFieldListField(
                "pElems", [], NDRShortField("", 0), size_is=lambda pkt: pkt.cElems
            )
        ),
    ]


class CAL(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfFieldListField(
                "pElems", [], NDRSignedIntField("", 0), size_is=lambda pkt: pkt.cElems
            )
        ),
    ]


class CAUL(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfFieldListField(
                "pElems", [], NDRIntField("", 0), size_is=lambda pkt: pkt.cElems
            )
        ),
    ]


class CAUH(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfPacketListField(
                "pElems", [], ULARGE_INTEGER, size_is=lambda pkt: pkt.cElems
            )
        ),
    ]


class CACLSID(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfPacketListField("pElems", [], GUID, size_is=lambda pkt: pkt.cElems)
        ),
    ]


class CALPWSTR(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfFieldListField(
                "pElems",
                [],
                NDRFullEmbPointerField(NDRConfVarStrNullFieldUtf16("", "")),
                size_is=lambda pkt: pkt.cElems,
            )
        ),
    ]


class CAPROPVARIANT(NDRPacket):
    ALIGNMENT = (4, 8)
    fields_desc = [
        NDRIntField("cElems", None, size_of="pElems"),
        NDRFullEmbPointerField(
            NDRConfPacketListField(
                "pElems",
                [],
                NDRRecursiveClass("tag_inner_PROPVARIANT"),
                size_is=lambda pkt: pkt.cElems,
            )
        ),
    ]


class tag_inner_PROPVARIANT(NDRPacket):
    ALIGNMENT = (8, 8)
    fields_desc = [
        NDRShortField("vt", 0),
        NDRByteField("wReserved1", 0),
        NDRByteField("wReserved2", 0),
        NDRIntField("wReserved3", 0),
        NDRUnionField(
            [
                (
                    StrFixedLenField("_varUnion", "", length=0),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            in [VARENUM.VT_EMPTY, VARENUM.VT_NULL]
                        ),
                        (lambda _, val: val.tag in [VARENUM.VT_EMPTY, VARENUM.VT_NULL]),
                    ),
                ),
                (
                    NDRSignedByteField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_I1),
                        (lambda _, val: val.tag == VARENUM.VT_I1),
                    ),
                ),
                (
                    NDRByteField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_UI1),
                        (lambda _, val: val.tag == VARENUM.VT_UI1),
                    ),
                ),
                (
                    NDRSignedShortField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_I2),
                        (lambda _, val: val.tag == VARENUM.VT_I2),
                    ),
                ),
                (
                    NDRShortField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_UI2),
                        (lambda _, val: val.tag == VARENUM.VT_UI2),
                    ),
                ),
                (
                    NDRSignedIntField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_I4),
                        (lambda _, val: val.tag == VARENUM.VT_I4),
                    ),
                ),
                (
                    NDRIntField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_UI4),
                        (lambda _, val: val.tag == VARENUM.VT_UI4),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", LARGE_INTEGER(), LARGE_INTEGER),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_I8),
                        (lambda _, val: val.tag == VARENUM.VT_I8),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", ULARGE_INTEGER(), ULARGE_INTEGER),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_UI8),
                        (lambda _, val: val.tag == VARENUM.VT_UI8),
                    ),
                ),
                (
                    NDRSignedShortField("_varUnion", 0),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_BOOL),
                        (lambda _, val: val.tag == VARENUM.VT_BOOL),
                    ),
                ),
                (
                    NDRFullEmbPointerField(NDRPacketField("_varUnion", GUID(), GUID)),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_CLSID),
                        (lambda _, val: val.tag == VARENUM.VT_CLSID),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", BLOB(), BLOB),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_BLOB),
                        (lambda _, val: val.tag == VARENUM.VT_BLOB),
                    ),
                ),
                (
                    NDRFullEmbPointerField(
                        NDRConfVarStrNullFieldUtf16("_varUnion", "")
                    ),
                    (
                        (lambda pkt: getattr(pkt, "vt", None) == VARENUM.VT_LPWSTR),
                        (lambda _, val: val.tag == VARENUM.VT_LPWSTR),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CAUB(), CAUB),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI1)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI1)
                        ),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CAUI(), CAUI),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI2)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI2)
                        ),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CAL(), CAL),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_I4)
                        ),
                        (lambda _, val: val.tag == (VARENUM.VT_VECTOR | VARENUM.VT_I4)),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CAUL(), CAUL),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI4)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI4)
                        ),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CAUH(), CAUH),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI8)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_UI8)
                        ),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CACLSID(), CACLSID),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_CLSID)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_CLSID)
                        ),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CALPWSTR(), CALPWSTR),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_LPWSTR)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_LPWSTR)
                        ),
                    ),
                ),
                (
                    NDRPacketField("_varUnion", CAPROPVARIANT(), CAPROPVARIANT),
                    (
                        (
                            lambda pkt: getattr(pkt, "vt", None)
                            == (VARENUM.VT_VECTOR | VARENUM.VT_VARIANT)
                        ),
                        (
                            lambda _, val: val.tag
                            == (VARENUM.VT_VECTOR | VARENUM.VT_VARIANT)
                        ),
                    ),
                ),
            ],
            StrFixedLenField("_varUnion", "", length=0),
            align=(2, 8),
            switch_fmt=("H", "H"),
        ),
    ]


class R_QMMgmtGetInfo_Request(NDRPacket):
    fields_desc = [
        NDRPacketField("pObjectFormat", MGMT_OBJECT(), MGMT_OBJECT),
        NDRIntField("cp", None, size_of="apVar"),
        NDRConfFieldListField(
            "aProp", [], NDRIntField("", 0), size_is=lambda pkt: pkt.cp
        ),
        NDRConfPacketListField(
            "apVar", [], tag_inner_PROPVARIANT, size_is=lambda pkt: pkt.cp
        ),
    ]


class R_QMMgmtGetInfo_Response(NDRPacket):
    fields_desc = [
        NDRConfPacketListField(
            "apVar", [], tag_inner_PROPVARIANT, size_is=lambda pkt: pkt.cp
        ),
        NDRIntField("status", 0),
    ]


class R_QMMgmtAction_Request(NDRPacket):
    fields_desc = [
        NDRPacketField("pObjectFormat", MGMT_OBJECT(), MGMT_OBJECT),
        NDRShortField("lpwszAction", 0),
    ]


class R_QMMgmtAction_Response(NDRPacket):
    fields_desc = [NDRIntField("status", 0)]


QMMGMT_OPNUMS = {
    0: DceRpcOp(R_QMMgmtGetInfo_Request, R_QMMgmtGetInfo_Response),
    1: DceRpcOp(R_QMMgmtAction_Request, R_QMMgmtAction_Response),
}
register_dcerpc_interface(
    name="qmmgmt",
    uuid=uuid.UUID("41208ee0-e970-11d1-9b9e-00e02c064c39"),
    version="1.0",
    opnums=QMMGMT_OPNUMS,
)
